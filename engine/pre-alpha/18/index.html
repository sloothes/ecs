<!DOCTYPE html>
<html lang="en">
	<head>

		<title>Legacy ECS Engine (pre-alpha 0.18)</title>

		<meta charset="utf-8">
		<meta name="generator" content="Three.js Editor">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<link rel="stylesheet" href="/css/joystick.css">
		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/bootbox-dialoges.css">
		<link rel="stylesheet" href="/css/jcrop.css">

		<script src="/js/watch.js"></script>
		<script src="/js/Objectid.js"></script>
		<script src="/js/jquery.min.js"></script> 
		<script src="/js/system.min.js"></script>
		<script src="/js/signals.min.js"></script>
		<script src="/js/inflate.min.js"></script>
		<script src="/js/zangodb.min.js"></script>
		<script src="/js/bootstrap.min.js"></script>
		<script src="/js/hold-event.min.js"></script>
		<script src="/js/jcrop.js"></script>

		<style>

			body {
				margin: 0px;
				font-size: 13px;
				font-family: sans-serif;
				background-repeat: repeat;
				background-image: url("https://i.imgur.com/rnZZU0i.png") !important;
				overflow: hidden;
			}

			#loading-bar {
				width:100%;
				height:100%;
				top:0; left:0;
				position:fixed;
				display:flex;
				align-items:center;
				justify-content:center;
			}

			.middle > * {
				top:0; 
				left:0;
				right:0;
				bottom:0;
				margin:auto;
				position:absolute;
			}

			#joystick1 {
				right: calc(40px + 370px);
			}
			
			#jumpButton {
				right: calc(105px + 370px);
			}

			.btn-matcap,
			.btn-terrain {
				padding:0;
				float:left;
				width:55px;
				height:55px;
				border:1px solid;
				border-radius:4px;
				margin-right:4px;
				margin-bottom:4px;
				display:inline-block;
			}

			.btn-matcap + .btn-matcap,
			.btn-terrain + .btn-terrain {
				margin-right:4px;
			}

		</style>
	</head>

	<body ontouchstart="">

		<script>

			debugMode = true;
			const Signal = signals.Signal;

		</script>

		<script src="/ecs/js/three.js"></script>
		<script src="/ecs/js/TabUI.js"></script>
		<script src="/ecs/js/MeshWalk.js"></script>
		<script src="/ecs/js/UVsDebug.js"></script>
		<script src="/ecs/js/FBXLoader.js"></script>
		<script src="/ecs/js/VirtualInput.js"></script>
		<script src="/ecs/js/KeyboardState.js"></script>
		<script src="/ecs/js/EditorControls.js"></script>
		<script src="/ecs/js/camera-controls.js"></script>
		<script src="/ecs/js/SubdivisionModifier.js"></script>
		<script src="/ecs/js/three-pathfinding.umd.js"></script>
		<script src="/threejs/r96/examples/js/loaders/GLTFLoader.js"></script>
		<script src="/threejs/r96/examples/js/exporters/GLTFExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/STLExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/OBJExporter.js"></script>
		<script src="/threejs/r96/examples/js/exporters/ColladaExporter.js"></script>

		<script>

		//	TabUI.

			(function(){

				var sidePanel = createSidePanel();
				document.body.appendChild( sidePanel );

			//	var loginTab = TabUI.add( "Login", "login-tab" );
			//	var debugTab = TabUI.add( "Debug", "debug-tab" );
			//	var levelTab = TabUI.add( "Levels", "level-tab" );
			//	var editorTab = TabUI.add( "Editor", "editor-tab" );
			//	var cameraTab = TabUI.add( "Camera", "camera-tab" );
			//	var controlTab = TabUI.add( "Controls", "control-tab" );
			//	var playersTab = TabUI.add( "Players", "players-tab" );
			//	var textureTab = TabUI.add( "Texture", "texture-tab" );
			//	var geoemtryTab = TabUI.add( "Geometry", "geometry-tab" );
			//	var materialTab = TabUI.add( "Material", "material-tab" );
			//	var animationTab = TabUI.add( "Animations", "animation-tab" );

			//	TabUI.append("Editor", "Material", "Texture", "Geometry", "Controls", "Camera", "Players", "Animations", "Levels", "Debug" );
			//	TabUI.Material.role.classList.add("active");
			//	TabUI.Material.tab.classList.add("in","active");

			})();

		</script>

		<script src="/ecs/engine/core/enviroment.js"></script>
		<script src="/ecs/engine/core/entity.js"></script>
		<script src="/ecs/engine/core/helpers.js"></script>
		<script src="/ecs/engine/core/localPlayer.js"></script>
		<script src="/ecs/engine/core/cameraControls.js"></script>
		<script src="/ecs/engine/core/keyboardState.js"></script>
		<script src="/ecs/engine/core/keyInputControls.js"></script>
		<script src="/ecs/engine/core/joystickControls.js"></script>
		<script src="/ecs/engine/core/keyboard.js"></script>
		<script src="/ecs/engine/editor/EditorTab.js"></script>
		<script src="/ecs/engine/editor/MaterialTab.js"></script>
		<script src="/ecs/engine/editor/MaterialManager.js"></script>
		<script src="/ecs/engine/editor/MaterialEditor.js"></script>

		<script>

		//	Texture tab.

			TabUI.add( "Texture", "texture-tab" );
			TabUI.append( "Texture" );

			TabUI.Editor.role.classList.remove("active");
			TabUI.Editor.tab.classList.remove("in","active");
			TabUI.Texture.role.classList.add("active");
			TabUI.Texture.tab.classList.add("in","active");

			const texture_droplist = (function( tab ){

			//	Textures droplist.
			//	When option is selected, switches to EditMode.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.textContent = "Entities:";
				row.style.cssText = "height:30px;"

				var select = document.createElement("select");
				select.id = "texture-entities-droplist";
				select.style.cssText = "width:170px;color:#000;float:right;"
				+ "border:1px solid;border-radius:4px;padding:2px 4px 4px 4px;"
				+ "font-size:20px;margin-left:10px;margin-right:15px;";

				(function(){
					var option = document.createElement("option");
					option.value = "";
					select.appendChild( option );
				})();

				row.appendChild( select );
				tab.appendChild( row );

				return select;

			})( TabUI.Texture.tab );

			(function( tab ){

			//	Texture viewer.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.style.cssText = "height:260px;border:none;text-align:center;";

				var canvas = document.createElement("canvas");
				canvas.width = 256; canvas.height = 256;
				canvas.id = "texture-viewer";
				canvas.style.cssText = "max-width:300px;max-height:300px;margin:auto;";

			//	Viewer scene.

				const scene = (function(){
					var scene = new THREE.Scene();
					scene.name = "viewer scene";
					return scene;
				})();

				const camera = (function(){
				//	var aspect = canvas.clientWidth / canvas.clientWidth;
					var camera  = new THREE.OrthographicCamera( -128,128,128,-128, 1, 1000 );
					camera.name = "viewer camera";
					camera.position.y = 10;
					camera.lookAt( 0,0,0 );
					scene.add( camera );
					return camera;
				})();
				
				const light = (function(){
					var light = new THREE.DirectionalLight( 0xffffff, 0.75 );
					light.name = "viewer light";
					camera.position.set( 0,10,0 );
					scene.add( light );
					return light;
				})();

				const grid = (function(){
					var helper = new THREE.GridHelper( 250, 10, 0x444444, 0x444444 );
					helper.name = "viewer grid";
					helper.position.y = 0.01;
					scene.add( helper );
					return helper;
				})();

				textureViewer = (function(){
					var mesh = new THREE.Mesh(
						new THREE.PlaneGeometry( 252, 252, 1, 1 ).rotateX(-Math.PI/2),
						new THREE.MeshLambertMaterial({ opacity:1, color:0x000000 })
					);  
					mesh.name = "texture viewer";
					mesh.material.name = "Viewer";
					material_entities.add( mesh.material );
					scene.add( mesh );
					return mesh;
				})();

			//  Renderer.

				const renderer = new THREE.WebGLRenderer({
					alpha: true,  // for transparent rendering set alpha:true, important!
					canvas: canvas,
					antialias: true,
					preserveDrawingBuffer: true,
				});

				renderer.gammaInput = true;
				renderer.gammaOutput = true;
				renderer.shadowMap.enabled = true;
				renderer.setClearAlpha( 0 ); // for transparent rendering set clear alpha: 0.
				renderer.setClearColor( 0x000000, 0 ); // for transparent rendering set clear alpha: 0.
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( canvas.width, canvas.height );
				renderer.domElement.style.background = "none";  // transparent rendering. important!

				window.addEventListener("resize", function onWindowResize() {
					renderer.setSize( canvas.width, canvas.width );
				//	camera.aspect = renderer.domElement.clientWidth / renderer.domElement.clientHeight;
				//	camera.updateProjectionMatrix();
				});

				(function render(){
					requestAnimationFrame( render );
					renderer.render( scene, camera );
				})();

				row.appendChild( canvas );
				tab.appendChild( row );

			})( TabUI.Texture.tab );

			(function( tab ){

			//	Undo/Redo button.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.style.cssText = "height:40px;margin-bottom:20px;"

				var redo = document.createElement("div");
				redo.id = "texture-redo-button";
				redo.textContent = "Redo";
				redo.style.cssText = "width:44%;float:left;height:40px;font-size:large;margin-right:15px;";
				redo.classList.add( "form-control", "btn", "btn-primary", "btn-white-outline", "gradient-btn" );

				var undo = document.createElement("div");
				undo.id = "texture-undo-button";
				undo.textContent = "Undo";
				undo.style.cssText = "width:44%;float:right;height:40px;font-size:large;margin-right:15px;";
				undo.classList.add( "form-control", "btn", "btn-primary", "btn-white-outline", "gradient-btn" );

				row.appendChild( redo );
				row.appendChild( undo );
				tab.appendChild( row );

			})( TabUI.Texture.tab );

			(function( tab ){

			//	Text input.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.style.cssText = "margin-right:20px;height:30px;";

				var input = document.createElement("input");
				input.id = "texture-text-input";
				input.setAttribute("placeholder", "text input" );
				input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;display:inline;width:100%;"
				+ "margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";

				row.appendChild(input);
				tab.appendChild( row );

			})( TabUI.Texture.tab );

			(function( tab ){

			//	Keys droplist.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.textContent = "key:";
				row.style.cssText = "height:40px;"

				var select = document.createElement("select");
				select.id = "texture-keys-droplist";
				select.style.cssText = "width:170px;color:#000;float:right;"
				+ "border:1px solid;border-radius:4px;padding:2px 4px 4px 4px;"
				+ "font-size:20px;margin-left:10px;margin-right:15px;";

				var keys = ",";
				keys += "uuid,name,mapping,rotation,format,minFilter,magFilter,anisotropy,flipY";

				keys.split(",").forEach(function( name ){
					var option = document.createElement("option");
					option.text = name;
					option.value = name;
					select.appendChild( option );
				});

				row.appendChild( select );
				tab.appendChild( row );

			})( TabUI.Texture.tab );

			(function( tab ){

			//	Value input.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.textContent = "value:";
				row.style.cssText = "margin:10px 15px;height:30px;";

				var vect = document.createElement("div");
				vect.style.cssText = "width:170px;height:40px;float:right;";

				var prev = document.createElement("li");
				prev.id = "texture-value-decrease";
				prev.innerHTML = "&#9668;";
				prev.style.display = "inline";
				prev.classList.add("btn","btn-primary","get-prev-btn","pull-left");

				var next = document.createElement("li");
				next.id = "texture-value-increase";
				next.innerHTML = "&#9658;";
				next.style.display = "inline";
				next.classList.add("btn","btn-primary","get-next-btn","pull-right");

				var input = document.createElement("input");
				input.id = "texture-value-input";
				input.setAttribute("placeholder", "value" );
				input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;border:none;display:inline;width:80px;"
				+ "margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";

				vect.appendChild(prev);
				vect.appendChild(input);
				vect.appendChild(next);
				row.appendChild(vect);
				tab.appendChild( row );

			})( TabUI.Texture.tab );

			(function( tab ){

			//	Vector mode droplist.
			//	When option is selected, switches to EditMode.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.textContent = "select:";
				row.style.cssText = "height:40px;"

				var select = document.createElement("select");
				select.id = "texture-vector-droplist";
				select.style.cssText = "width:170px;color:#000;float:right;"
				+ "border:1px solid;border-radius:4px;padding:2px 4px 4px 4px;"
				+ "font-size:20px;margin-left:10px;margin-right:15px;";

				var keys = "";
				keys += "offset,repeat,center,wrap";

				keys.split(",").forEach(function( name ){
					var option = document.createElement("option");
					option.text = name;
					option.value = name;
					select.appendChild( option );
				});

				row.appendChild( select );
				tab.appendChild( row );

			})( TabUI.Texture.tab );

		//	Vector controls.

			(function( tab ){

			//	vector x.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.textContent = "vect x:";
				row.style.cssText = "margin:10px 15px;height:40px;";

				var vect = document.createElement("div");
				vect.style.cssText = "width:170px;height:40px;float:right;";

				var prev = document.createElement("li");
				prev.id = "texture-vector-x-decrease";
				prev.innerHTML = "&#9668;";
				prev.style.display = "inline";
				prev.classList.add("btn","btn-primary","get-prev-btn","pull-left");

				var next = document.createElement("li");
				next.id = "texture-vector-x-increase";
				next.innerHTML = "&#9658;";
				next.style.display = "inline";
				next.classList.add("btn","btn-primary","get-next-btn","pull-right");

				var input = document.createElement("input");
				input.id = "texture-vector-x-input";
				input.setAttribute("placeholder", "x" );
				input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;border:none;display:inline;width:80px;"
					+ "margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";

				vect.appendChild(prev);
				vect.appendChild(input);
				vect.appendChild(next);
				row.appendChild(vect);
				tab.appendChild( row );

			})( TabUI.Texture.tab );

			(function( tab ){

			//	vector y.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.textContent = "vect y:";
				row.style.cssText = "margin:10px 15px;height:40px;";

				var vect = document.createElement("div");
				vect.style.cssText = "width:170px;height:40px;float:right;";

				var prev = document.createElement("li");
				prev.id = "texture-vector-y-decrease";
				prev.innerHTML = "&#9668;";
				prev.style.display = "inline";
				prev.classList.add("btn","btn-primary","get-prev-btn","pull-left");

				var next = document.createElement("li");
				next.id = "texture-vector-y-increase";
				next.innerHTML = "&#9658;";
				next.style.display = "inline";
				next.classList.add("btn","btn-primary","get-next-btn","pull-right");

				var input = document.createElement("input");
				input.id = "texture-vector-y-input";
				input.setAttribute("placeholder", "y" );
				input.classList.add("form-control","text-center");
				input.style.cssText = "color:#000;border:none;display:inline;width:80px;"
					+ "margin:0px 5px;text-align:center;font-size:large;font-weigth:bold;background:none;";

				vect.appendChild(prev);
				vect.appendChild(input);
				vect.appendChild(next);
				row.appendChild(vect);
				tab.appendChild( row );

			})( TabUI.Texture.tab );

			(function( tab ){

			//	Import texture button.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.style.cssText = "height:40px;margin-bottom:20px;"

				var button = document.createElement("div");
				button.id = "texture-import-button";
				button.textContent = "Import Texture Entity";
				button.style.cssText = "width:295px;float:right;height:40px;font-size:large;margin-right:15px;";
				button.classList.add( "form-control", "btn", "btn-primary", "btn-white-outline", "gradient-btn" );

				var input = document.createElement("input");
				input.type = "file";
				input.id = "texture-file-input";
				input.style.cssText = "display:none;";
				button.appendChild( input );

				button.addEventListener( "click", function(){
					input.files.length = 0;
					input.click();
				});

				row.appendChild( button );
				tab.appendChild( row );

			})( TabUI.Texture.tab );

			(function( tab ){

			//	Exit edit mode button.
			//	var tab = TabUI.Texture.tab;

				var row = document.createElement("h3");
				row.style.cssText = "height:40px;margin-bottom:20px;"

				var button = document.createElement("div");
				button.id = "texture-exit-mode";
				button.textContent = "Exit Edit Mode";
				button.style.cssText = "width:295px;float:right;height:40px;font-size:large;margin-right:15px;";
				button.classList.add( "form-control", "btn", "btn-primary", "btn-white-outline", "gradient-btn" );

				row.appendChild( button );
				tab.appendChild( row );

			})( TabUI.Texture.tab );

		</script>

		<script>

		//	Texture Manager Class.

		//	Texture Manager: inherits (extends) Array class.
		//	sources: https://stackoverflow.com/questions/26700164/extending-array-with-es6-classes
		//	https://stackoverflow.com/questions/11337849/ways-to-extend-array-object-in-javascript

			function TextureManager(){
				var array = new Array(0);
				Object.setPrototypeOf( array, TextureManager.prototype );
				return array; // important!
			};

			TextureManager.prototype = Object.create(Array.prototype);
			TextureManager.prototype.move = function( entity, new_index ){

				var old_index = this.findIndex(function( item ){
					return item.id === entity.id;
				});

				if ( old_index < 0 ) return; // important!
				if ( old_index == new_index ) return;

				(function( arr, old_index, new_index ){

					if (new_index >= arr.length) {
						var k = new_index - arr.length + 1;
						while (k--) {
							arr.push(undefined);
						}
					}

					arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);

				})( this, old_index, new_index);

			};

			TextureManager.prototype.add = function(){
			//	params: {object:Material} 

				if ( arguments.length < 1 ) return;

				var materials  = [];

			//	Get materials/ids.
				for ( var i in arguments ) {
					var param = arguments[i];
					if ( typeof param === "object" && param.isMaterial && param.id !== undefined )
						materials.push( param );  // meterial;
					else 
						continue;
				}

				if ( !materials.length ) return;
			//	console.log( "materials:", materials );

				var length = materials.length;
				for ( var j = 0; j < length; j++ ) {
					this.push( materials[j] );
				}

			//	var material_droplist = document.getElementById("material-entities-droplist");
			//	global const "material_droplist" is defined in MaterialTab.js;
				if ( !material_droplist ) return;

			//	Add options.
				while ( materials.length ) (function( material ){
					var str =  "", dot = ".", col = ":";
					var type = "object";
					var name = material.name || "mtl"+material.id;
					if ( material.type ) type = material.type;
					var option = document.createElement("option");
					option.text = str+material.id+dot+type+col+name;
					option.value = material.id;
					material_droplist.appendChild( option );
				})( materials.shift() );
			};

			TextureManager.prototype.remove = function(){
			//	params: {number:entity.id} or {object:entity} 

				if ( arguments.length < 1 ) return;

			//	Get removed ids.
				var remove_ids = [];
				for ( var i in arguments ) {
					var param = arguments[i];
					if ( typeof param === "number" && param % 1 === 0 ) // integer. 
						remove_ids.unshift( param );    // remove_ids.push( param );
					else if ( typeof param === "object" && param.isMaterial && param.id !== undefined )
						remove_ids.unshift( param.id ); // remove_ids.push( param.id );
					else 
						continue;
				}

				if ( !remove_ids.length ) return;
			//	console.log( "remove_ids:", remove_ids );

				var length = remove_ids.length;
				for ( var j = 0; j < length; j++ ) {

					var _id = remove_ids[ j ];

				//	Find index.
					var index = this.findIndex(function( item ){
						return item.id === _id;
					});

					if ( index < 0 ) continue; // important!

					var removedItems = this.splice(index, 1);
				//	debugMode && console.log( removedItems );

					while ( removedItems.length ){
						var removed = removedItems.shift();
					//	debugMode && console.log( removed );
						removed_materials.push( removed );
					}
				}

			//	global const "texture_droplist" is defined in TextureTab.js;
			//	var texture_droplist = document.getElementById("texture-entities-droplist");

				if ( !texture_droplist ) return;

			//	Remove options.
				while ( remove_ids.length ) (function( id ){
					var selector = "option[value='" + id.toString() + "']"; // console.log( selector );
					var option = texture_droplist.querySelector( selector ); // console.log(  option  );
					option && option.remove();
				})( remove_ids.shift() );

			};

			TextureManager.prototype.clear = function(){

				this.length = 0;

			};

		</script>

		<script>

		//	Texture Editor.

			const texture_entities = new TextureManager(); // texture entities array, important!.
			const removed_textures = new TextureManager(); // texture entities array, important!.

		//	Create a texture json to hold editor data.
			const textureEditor = ( function( editor ){

				const images = {};
				const undo = [], redo = [];

			//	droplists.

				const keySelect    = {value:""}; // string.
				const entitySelect = {value:""}; // string.
				const vectorSelect = {value:""}; // string.

				const keys_droplist   = document.getElementById("texture-keys-droplist");
				const entity_droplist = document.getElementById("texture-entities-droplist");
				const vector_droplist = document.getElementById("texture-vector-droplist");

			//	inputs.

				const text_input  = document.getElementById("texture-text-input");
				const value_input = document.getElementById("texture-value-input");
				const vector_x_input = document.getElementById("texture-vector-x-input");
				const vector_y_input = document.getElementById("texture-vector-y-input");

			//	input buttons.

				const value_increase_button = document.getElementById("texture-value-increase");
				const value_decrease_button = document.getElementById("texture-value-decrease");
				const vector_x_increase_button = document.getElementById("texture-vector-x-increase");
				const vector_x_decrease_button = document.getElementById("texture-vector-x-decrease");
				const vector_y_increase_button = document.getElementById("texture-vector-y-increase");
				const vector_y_decrease_button = document.getElementById("texture-vector-y-decrease");



















				return editor;

			})( new THREE.Texture().toJSON() );

		</script>

		<script>

			localPlayer.controller.movementSpeed = 10;

		//	Entities.

		//	debugMode && (function(){
		//		var r = 1;
		//		var geometry = new THREE.BoxGeometry(r,r,r);
		//		var material = new THREE.MeshLambertMaterial();
		//		var cube = new THREE.Mesh(geometry, material);
		//		cube.name = "local player cube";
		//		var geometry = new THREE.SphereGeometry(0.7,8,12);
		//		var material = new THREE.MeshLambertMaterial();
		//		var sphere = new THREE.Mesh(geometry, material);
		//		sphere.name = "local player sphere";
		//	//	cube.add( sphere );
		//		localPlayer.add( cube );
		//	})();

		//	box coluctions.

			debugMode && (function(){

				var material = new THREE.MeshLambertMaterial({name:"mtl00"});

				(function(){
					var w = 10; var h = 5;
					var box = new THREE.BoxGeometry(w,h,w);
					box.translate(0, h/2, 0);
					octree.importThreeMesh( new THREE.Mesh(box) );
					var geometry = new THREE.EdgesGeometry( box );
					var material = new THREE.LineBasicMaterial( { color: 0x00ff00 } );
					var segments = new THREE.LineSegments( geometry, material );
					segments.name = "segments 1";
					scene.add( segments );
				})();

				(function(){
					var w = 10, h = 20;
					var x = 10, y = h/2, z = -4;
					var box = new THREE.BoxGeometry(w,h,w);
					box.translate(0, h/2, 0);
					var material = new THREE.MeshLambertMaterial();
					var mesh = new THREE.Mesh(box, material);
					mesh.name = "building 1";
					mesh.position.set(x,0,z);
					octree.importThreeMesh( mesh );
					var geometry = new THREE.EdgesGeometry( box );
					var segments = new THREE.LineSegments( geometry, material );
					segments.name = "segments 2";
					segments.position.copy( mesh.position );
					scene.add( mesh );
					cameraControls.rigidObjects.push( mesh );
				})();

				(function(){
					var w = 12, h = 10;
					var x = 15, y = h/2, z = -11;
					var box = new THREE.BoxGeometry(w,h,w);
					box.translate(0, h/2, 0);
					var material = new THREE.MeshLambertMaterial();
					var mesh = new THREE.Mesh(box, material);
					mesh.name = "building 2";
					mesh.position.set(x,0,z);
					octree.importThreeMesh( mesh );
					var geometry = new THREE.EdgesGeometry( box );
					var segments = new THREE.LineSegments( geometry, material );
					segments.name = "segments 3";
					segments.position.copy( mesh.position );
					scene.add( mesh );
					cameraControls.rigidObjects.push( mesh );
				})();

				(function(){
					var w = 8, h = 10;
					var x = -9, y = h/2, z = 5;
					var box = new THREE.BoxGeometry(w,h,w);
					box.translate(0, h/2, 0);
					var material = new THREE.MeshLambertMaterial();
					var mesh = new THREE.Mesh(box, material);
					mesh.name = "building 3";
					mesh.position.set(x,0,z);
					octree.importThreeMesh( mesh );
					var geometry = new THREE.EdgesGeometry( box );
					var segments = new THREE.LineSegments( geometry, material );
					segments.name = "segments 4";
					segments.position.copy( mesh.position );
					scene.add( mesh );
					cameraControls.rigidObjects.push( mesh );
				})();

				(function(){
					var w = 12, h = 20, d = 2;
					var x = -14, y = h/2, z = 10;
					var box = new THREE.BoxGeometry(w,h,d);
					box.translate(0, h/2, 0);
					var material = new THREE.MeshLambertMaterial();
					var mesh = new THREE.Mesh(box, material);
					mesh.name = "building 4";
					mesh.position.set(x,0,z);
					octree.importThreeMesh( mesh );
					var geometry = new THREE.EdgesGeometry( box );
					var segments = new THREE.LineSegments( geometry, material );
					segments.name = "segments 5";
					segments.position.copy( mesh.position );
					scene.add( mesh );
					cameraControls.rigidObjects.push( mesh );
				})();

				(function(){
					var w = 4, h = 20, d = 20;
					var x = -17, y = h/2, z = 12;
					var box = new THREE.BoxGeometry(w,h,d);
					box.translate(0, h/2, 0);
					var material = new THREE.MeshLambertMaterial();
					var mesh = new THREE.Mesh(box, material);
					mesh.name = "building 5";
					mesh.position.set(x,0,z);
					octree.importThreeMesh( mesh );
					var geometry = new THREE.EdgesGeometry( box );
					var segments = new THREE.LineSegments( geometry, material );
					segments.name = "segments 6";
					segments.position.copy( mesh.position );
					scene.add( mesh );
					cameraControls.rigidObjects.push( mesh );
				})();

			//	var groupA = new THREE.Object3D();
			//	var groupB = new THREE.Object3D();

			//	groupA.add( scene.getObjectByName("building 1").clone() );
			//	groupA.add( scene.getObjectByName("building 2").clone() );
			//	groupB.add( scene.getObjectByName("building 3").clone() );
			//	groupB.add( scene.getObjectByName("building 4").clone() );
			//	groupB.add( scene.getObjectByName("building 5").clone() );

			})();

		</script>

		<script>

		//	Add entities.

		//	Add Object3D entities.
			scene.traverse(function( object ){
				entities.add( object );
			});

		//	Add Material entities.
			entities.forEach( function( entity ){

			//	It looks in "entities" manager only.
			//	It looks the root Object3D, but not children.

				var object = scene.getObjectById( entity.id );
				if ( !object || !object.material ) return; // important!

				if ( Array.isArray( object.material ) )
					object.material.forEach( addtoManager );
				else 
					addtoManager( object.material );

				function addtoManager( material ){
					rename( material );
					addEntity( material );
				}

				function rename( material ){
					if ( material.name ) return;
					material.name = "mtl"+material.id;;
				}

				function addEntity( material ){
					var included = material_entities.includes( material );
					debugMode && console.log( "included:", included );
					if ( !included ) material_entities.add( material );
				}
			});

			console.log( {"object3DEditor": object3DEditor} ); // debug!
			console.log( {"materialEditor": materialEditor} ); // debug!

		</script>

	</body>
</html>
